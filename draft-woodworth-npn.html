<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Numeric Pattern Normalization (NPN)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Background and Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 The NPN Resource Record">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 NPN RDATA Wire Format">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 The NPN RR Presentation Format">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Use and Normalization Processing of NPN RRs">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Pseudocode for NPN Normalization Processing">
<link href="#rfc.section.3" rel="Chapter" title="3 Security Considerations">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Normalized (NPN-Based) Signatures">
<link href="#rfc.section.4" rel="Chapter" title="4 Privacy Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A NPN Examples">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 EXAMPLE 1">
<link href="#rfc.appendix.A.2" rel="Chapter" title="A.2 EXAMPLE 2">
<link href="#rfc.appendix.A.3" rel="Chapter" title="A.3 EXAMPLE 3">
<link href="#rfc.appendix.A.4" rel="Chapter" title="A.4 EXAMPLE 4">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.9 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Woodworth, J., Ballew, D., Bindinganaveli Raghavan, S., and D. Lawrence" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-woodworth-npn-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-07-15" />
  <meta name="dct.abstract" content="The Numeric Pattern Normalization (NPN) resource record provides pre-processing information to reduce the number of possible variants which can be generated by pattern-based RR's into a single signable record." />
  <meta name="description" content="The Numeric Pattern Normalization (NPN) resource record provides pre-processing information to reduce the number of possible variants which can be generated by pattern-based RR's into a single signable record." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DNSOP Working Group</td>
<td class="right">J. Woodworth</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">D. Ballew</td>
</tr>
<tr>
<td class="left">Updates: 2308, 4033, 4034, 4035 (if</td>
<td class="right">CenturyLink, Inc.</td>
</tr>
<tr>
<td class="left">         approved)</td>
<td class="right">S. Bindinganaveli Raghavan</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Hughes Network Systems</td>
</tr>
<tr>
<td class="left">Expires: January 16, 2020</td>
<td class="right">D. Lawrence</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Oracle</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 15, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Numeric Pattern Normalization (NPN)<br />
  <span class="filename">draft-woodworth-npn-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Numeric Pattern Normalization (NPN) resource record provides pre-processing information to reduce the number of possible variants which can be generated by pattern-based RR's into a single signable record.</p>
<h1><a>Ed note</a></h1>
<p>Text inside square brackets ([]) is additional background information, answers to frequently asked questions, general musings, etc.  They will be removed before publication.  This document is being collaborated on in GitHub at &lt;https://github.com/ioneyez/npn&gt;.  The most recent version of the document, open issues, etc should all be available here.  The authors gratefully accept pull requests.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 16, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Background and Terminology</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">The NPN Resource Record</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">NPN RDATA Wire Format</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">The NPN RR Presentation Format</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Use and Normalization Processing of NPN RRs</a>
</li>
<ul><li>2.3.1.   <a href="#rfc.section.2.3.1">Pseudocode for NPN Normalization Processing</a>
</li>
</ul></ul><li>3.   <a href="#rfc.section.3">Security Considerations</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Normalized (NPN-Based) Signatures</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Privacy Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgments</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<ul><li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">NPN Examples</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">EXAMPLE 1</a>
</li>
<li>A.2.   <a href="#rfc.appendix.A.2">EXAMPLE 2</a>
</li>
<li>A.3.   <a href="#rfc.appendix.A.3">EXAMPLE 3</a>
</li>
<li>A.4.   <a href="#rfc.appendix.A.4">EXAMPLE 4</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The Numeric Pattern Normalization (NPN) resource record provides methods to generate DNSSEC signatures for pattern-based "synthesized" RR's, and validation of such signatures.  It does this by introducing a pre-processing step of pattern substitution into both the signing and validating processes.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#background-and-terminology" id="background-and-terminology">Background and Terminology</a>
</h1>
<p id="rfc.section.1.1.p.1">The reader is assumed to be familiar with the basic DNS and DNSSEC concepts described in <a href="#RFC1034" class="xref">[RFC1034]</a>, <a href="#RFC1035" class="xref">[RFC1035]</a>, <a href="#RFC4033" class="xref">[RFC4033]</a>, <a href="#RFC4034" class="xref">[RFC4034]</a>, and <a href="#RFC4035" class="xref">[RFC4035]</a>; subsequent RFCs that update them in <a href="#RFC2181" class="xref">[RFC2181]</a> and <a href="#RFC2308" class="xref">[RFC2308]</a>; and DNS terms in <a href="#RFC7719" class="xref">[RFC7719]</a>.</p>
<p id="rfc.section.1.1.p.2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#the-npn-resource-record" id="the-npn-resource-record">The NPN Resource Record</a>
</h1>
<p id="rfc.section.2.p.1">The Numeric Pattern Normalization (NPN) resource record provides pre-processing information to reduce the number of possible variants that can be generated by a pattern-based RR into one signable record.  By identifying parts of the dynamic resource record which should be ignored or represented as a static value, one exemplar record and signature is used to validate all other records that match the pattern.</p>
<p id="rfc.section.2.p.2">For example, a pattern replacement like pool-A-${1}-${2}.example.com that generates PTR records for pool-A-0-0.example.com through pool-A-255-255.example.com would have an NPN record that signals a validating resolver to verify all pool-A-#-#.example.com names against a record for pool-A-9-9.example.com.</p>
<p id="rfc.section.2.p.3">Though it is conceivable that forged records could be validated as legitimate, such forged records must meet strict criteria and match patterns which define and are considered legitimate.  The added measure is a notable improvement in security over being hosted in insecure zones.</p>
<p id="rfc.section.2.p.4">The Type value for the NPN RR type is TBD.</p>
<p id="rfc.section.2.p.5">The NPN RR is class independent and has no special TTL requirements.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#npn-rdata-wire-format" id="npn-rdata-wire-format">NPN RDATA Wire Format</a>
</h1>
<p id="rfc.section.2.1.p.1">The RDATA for an NPN RR consists of a 2 octet Match Type field, a 1 octet Flags field, a 1 octet Owner Ignore field, a 1 octet Left Ignore field and a 1 octet Right Ignore field.</p>
<pre>
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Match Type          |     Flags     |  Owner Ignore |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Left Ignore  |  Right Ignore |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.2.1.p.2">Match Type indicates the type of the RRset with which this record is associated.</p>
<p id="rfc.section.2.1.p.3">Flags defines additional processing parameters for data normalization.  This document defines only the Period-As-Number flag "." (position 5), the Hyphen-As-Number "-" (position 6) and the hexadecimal flag "X" (position 7).  All other flags are reserved for future use.</p>
<pre>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|Reserved |.|-|X|
+-+-+-+-+-+-+-+-+

Bits 0-4: Reserved for future

Bit    5: Period As Number (.) Flag
   If 0, periods are treated as non-digits.
   If 1, periods will be processed as digits.

Bit    6: Hyphen As Number (-) Flag
   If 0, hyphens are treated as non-digits.
   If 1, hyphens will be processed as digits.

Bit    7: Hexadecimal (X) Flag
   If 0, numeric digits include only 0-9.
   If 1, numeric digits include a-f in addition to 0-9.
</pre>
<p id="rfc.section.2.1.p.4">Owner Ignore defines the number of octets in the owner name, as counted from the left, which MUST be ignored by the normalization process.  This field offers additional security to pattern based signatures which may not be immediately apparent.  By restricting the leftmost characters defined by this value, ultimately the length of the generated portion of the accompanying synthesized RR will be confined accordingly.</p>
<p id="rfc.section.2.1.p.5">Left Ignore defines the number of octets of the generated RDATA, as counted from the left, which MUST be ignored by the normalization process.</p>
<p id="rfc.section.2.1.p.6">Right Ignore defines the number of octets of the generated RDATA, as counted from the right, which MUST be ignored by the normalization process.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#the-npn-rr-presentation-format" id="the-npn-rr-presentation-format">The NPN RR Presentation Format</a>
</h1>
<p id="rfc.section.2.2.p.1">Match Type is represented as an RR type mnemonic or with <a href="#RFC3597" class="xref">[RFC3597]</a>'s generic TYPE mechanism.</p>
<p id="rfc.section.2.2.p.2">Flags is a string of characters indicating the status of each bit as per the following table.  The characters can appear in any order.</p>
<pre>
+------------------+-----------+-----------+
|       Flag       |   Unset   |    Set    |
+------------------+-----------+-----------+
| Period As Number |           |     .     |
+------------------+-----------+-----------+
| Hyphen As Number |           |     -     |
+------------------+-----------+-----------+
|   Hexadecimal    |     9     |     f     |
+------------------+-----------+-----------+
</pre>
<p id="rfc.section.2.2.p.3">Owner Ignore, Left Ignore, and Right Ignore are displayed as unsigned decimal integers, ranging from 0 through 255.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#use-and-normalization-processing-of-npn-rrs" id="use-and-normalization-processing-of-npn-rrs">Use and Normalization Processing of NPN RRs</a>
</h1>
<p id="rfc.section.2.3.p.1">This document provides a minor yet significant modification to DNSSEC regarding how RRsets will be signed or verified.  Specifically the Signature Field of <a href="#RFC4034" class="xref">[RFC4034]</a>, Section 3.1.8.  Prior to processing into canonical form, signed zones may contain associated RRs where; owner, class and type of a non NPN RR directly corresponds with an NPN RR matching owner, class and Match Type.  If this condition exists the NPN RR's RDATA defines details for processing the associated RDATA into a "Normalized" format.  Normalized data is based on pre-canonical formatting and zero padded for "A" and "AAAA" RR types for acceptable precision during the process.  This concept will become clearer in the NPN pseudocode and examples provided in the sections to follow.</p>
<p id="rfc.section.2.3.p.2">The rules for this transformation are simple:</p>
<p></p>

<ul>
<li>For RR's Owner field, characters from the beginning to the index of the Owner Ignore value or the final string of characters belonging to the zone's ORIGIN MUST NOT be modified by this algorithm.  This value is intended to provide additional limitations on the query portion further minimizing the risk of spoofed RR's matching NPN-based signatures.</li>
<li>For RR's RDATA field, character from beginning to the index of Left Ignore value or characters with index of Right Ignore value to the end MUST NOT be modified by this algorithm.</li>
<li>In the remaining portion of both Owner and RDATA strings of numeric data, defined as character "0" through "f" or "0" through "9" depending on whether or not the Hexadecimal flag is set or not, MUST be consolidated to a single character and set to the highest value defined by the Hexadecimal flag.  Examples may be found in the following section.  If period-as-number or hyphen-as-number flags are set whichever are used ("." or "-") would be treated as part of the number and consolidated where appropriate.</li>
</ul>
<p id="rfc.section.2.3.p.4">Once the normalization has been performed the signature will continue processing into canonical form using the normalized RRs in the place of original ones.</p>
<p id="rfc.section.2.3.p.5">If multiple NPN RR's resolve to the same owner and type, it MUST be assumed either multiple overlapping pattern-based generation RR's coexist for the same owner.  In this scenario, the validation algorithm SHOULD be attempted against all NPN RR's until a successful validation is found or no NPN's for this owner and type remain.  While multiple overlapping pattern-based generation SHOULD be discouraged, future pattern-based RR's may necessitate this condition so it must be accounted for.</p>
<p id="rfc.section.2.3.p.6">NPN RRs MAY be included in the "Additional" section to provide a hint of the NPN processing required for the verification path.</p>
<p id="rfc.section.2.3.p.7">It is important to note, properly sizing the Ignore fields is critical to minimizing the risk of spoofed signatures.  Never intentionally set all Ignore values to zero in order to make validation easier as it places the validity of zone data at risk. Only accompany RRs which are pattern derived (such as BULK) with NPN records as doing so may unnecessarily reduce the confidence level of generated signatures.</p>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> <a href="#pseudocode-for-npn-normalization-processing" id="pseudocode-for-npn-normalization-processing">Pseudocode for NPN Normalization Processing</a>
</h1>
<p id="rfc.section.2.3.1.p.1">This section provides a simple demonstration of process flow for NPN rdata normalization and DNSSEC signatures.</p>
<p id="rfc.section.2.3.1.p.2">The pseudocode provided below assumes all associated RRs are valid members of a DNSSEC-compatible RRset, including pattern-generated ones.</p>
<pre>
   for rr in rrset
       if (has_NPN&lt;rr.owner, rr.class, rr.type&gt;)
           rr.rdata_normal = NPN_normalize&lt;rr.rdata&gt;
           add_to_sigrrset&lt;NPN.owner, rr.class, rr.type,
               rr.rdata_normal&gt;
           next
       else
           add_to_sigrrset&lt;rr.owner, rr.class, rr.type, rr.rdata&gt;
           next

   process_canonical_form&lt;sigrrset&gt;

   dnssec_sign&lt;sigrrset&gt;
</pre>
<p id="rfc.section.2.3.1.p.3">Similar logic MUST be used for determining DNSSEC validity of RRsets in validating nameservers for signatures generated based on NPN normalization.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.3.p.1">The NPN RR is intended to be used only with the offline-signing of pattern-based RR's where there is an expected minimal security impact.  Use of NPN RR's for other purposes is strongly discouraged and falls outside the scope of this document.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#normalized-npn-based-signatures" id="normalized-npn-based-signatures">Normalized (NPN-Based) Signatures</a>
</h1>
<p id="rfc.section.3.1.p.1">This solution provides a flexible solution as nameservers without on-the-fly signing capabilities can still support signatures for pattern-based records.  The down side to this solution is it requires NPN resolver support for validation.</p>
<p id="rfc.section.3.1.p.2">It has been pointed out that due to this limitation, creation of DNSSEC-signed pattern-based RRs requiring NPN support SHOULD be formally discouraged until such time a respectable percentage (&gt;80%) of validating resolvers in-the-wild possess NPN processing capabilities.  Until that time, on-the-fly signing and unsigned records offer the intended capabilities for pattern-based RR's, while requiring zero new features to support their resolution.  Given enough time, enough nameservers will be patched and upgraded for unrelated reasons and by means of simple attrition can supply a level of inertia and eventually widespread adoption can be assumed.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#privacy-considerations" id="privacy-considerations">Privacy Considerations</a>
</h1>
<p id="rfc.section.4.p.1">NPN records do not introduce any new privacy concerns to DNS data.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">IANA is requested to assign numbers for the NPN DNS resource record type identified in this document.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.6.p.1">This document was created as an extension to the DNS infrastructure. As such, many people over the years have contributed to its creation and the authors are appreciative to each of them even if not thanked or identified individually.</p>
<p id="rfc.section.6.p.2">A special thanks is extended for the kindness, wisdom and technical advice of Robert Whelton (CenturyLink, Inc.) and Gary O'Brien (Secure64).</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1034">[RFC1034]</b></td>
<td class="top">
<a>Mockapetris, P.</a>, "<a href="https://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>", STD 13, RFC 1034, DOI 10.17487/RFC1034, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1035">[RFC1035]</b></td>
<td class="top">
<a>Mockapetris, P.</a>, "<a href="https://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, DOI 10.17487/RFC1035, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2181">[RFC2181]</b></td>
<td class="top">
<a>Elz, R.</a> and <a>R. Bush</a>, "<a href="https://tools.ietf.org/html/rfc2181">Clarifications to the DNS Specification</a>", RFC 2181, DOI 10.17487/RFC2181, July 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2308">[RFC2308]</b></td>
<td class="top">
<a>Andrews, M.</a>, "<a href="https://tools.ietf.org/html/rfc2308">Negative Caching of DNS Queries (DNS NCACHE)</a>", RFC 2308, DOI 10.17487/RFC2308, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2317">[RFC2317]</b></td>
<td class="top">
<a>Eidnes, H.</a>, <a>de Groot, G.</a> and <a>P. Vixie</a>, "<a href="https://tools.ietf.org/html/rfc2317">Classless IN-ADDR.ARPA delegation</a>", BCP 20, RFC 2317, DOI 10.17487/RFC2317, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3597">[RFC3597]</b></td>
<td class="top">
<a>Gustafsson, A.</a>, "<a href="https://tools.ietf.org/html/rfc3597">Handling of Unknown DNS Resource Record (RR) Types</a>", RFC 3597, DOI 10.17487/RFC3597, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4033">[RFC4033]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="https://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>", RFC 4033, DOI 10.17487/RFC4033, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4034">[RFC4034]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="https://tools.ietf.org/html/rfc4034">Resource Records for the DNS Security Extensions</a>", RFC 4034, DOI 10.17487/RFC4034, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4035">[RFC4035]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="https://tools.ietf.org/html/rfc4035">Protocol Modifications for the DNS Security Extensions</a>", RFC 4035, DOI 10.17487/RFC4035, March 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC7719">[RFC7719]</b></td>
<td class="top">
<a>Hoffman, P.</a>, <a>Sullivan, A.</a> and <a>K. Fujiwara</a>, "<a href="https://tools.ietf.org/html/rfc7719">DNS Terminology</a>", RFC 7719, DOI 10.17487/RFC7719, December 2015.</td>
</tr></tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#npn-examples" id="npn-examples">NPN Examples</a>
</h1>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> <a href="#example-1" id="example-1">EXAMPLE 1</a>
</h1>
<pre>
2.10.in-addr.arpa. 86400 IN BULK PTR (
                                 [0-255].[0-10].2.10.in-addr.arpa.
                                 pool-A-${1}-${2}.example.com.
                            )
2.10.in-addr.arpa. 86400 IN NPN  PTR 9 0 7 13
</pre>
<p id="rfc.section.A.1.p.1">For the BULK RR used in this example, a query for the PTR of address 10.2.3.44 would match the for the query name 44.3.2.10.in-addr.arpa, resulting in the generation of a PTR to pool-A-3-44.example.com as the response.</p>
<p id="rfc.section.A.1.p.2">By protecting the "Ignore" characters from the generated RR's RDATA the focus for normalization becomes "3-44" as illustrated below.</p>
<pre>
  0 1 2 3 4 5 6 7
                v---------
    p o o l - A - 3 - 4 4 . e x a m p l e . c o m .
                 ---------^
                          1 1 1 1                  
                          3 2 1 0 9 8 7 6 5 4 3 2 1 0
</pre>
<p id="rfc.section.A.1.p.3">Everything to the left of "3-44" will remain intact, as will everything to its right.  The remaining characters will be processed for digits between 0 and 9 as indicated by the NPN record's hexadecimal flag 9, and each run of digits replaced by the single character "9".  The final Normalized RDATA for *.2.10.in-addr.arpa would therefore become pool-A-9-9.example.com., and its signature would be based on this value to cover all possible permutations of the pool-A-${1}-${2}.example.com replacement pattern.</p>
<p id="rfc.section.A.1.p.4">Since the validating nameserver would use the identical NPN record for processing and comparison, all RRs generated by the BULK record can now be verified with a single signature.</p>
<h1 id="rfc.appendix.A.2">
<a href="#rfc.appendix.A.2">A.2.</a> <a href="#example-2" id="example-2">EXAMPLE 2</a>
</h1>
<p id="rfc.section.A.2.p.1">This example contains a classless IPv4 delegation on the /22 CIDR boundary as defined by <a href="#RFC2317" class="xref">[RFC2317]</a>.  The network for this example is "10.2.0/22" delegated to a nameserver "ns1.sub.example.com.".  RRs for this example are defined as:</p>
<pre>
$ORIGIN 2.10.in-addr.arpa.
0-3 86400 IN      NS    ns1.sub.example.com.
    86400 IN BULK CNAME [0-255].[0-3] ${*|.}.0-3
    86400 IN NPN  CNAME 9 0 0 23
</pre>
<p id="rfc.section.A.2.p.2">For this example, a query of "10.2.2.65" would enter the nameserver as "65.2.2.10.in-addr.arpa." and a "CNAME" RR with the RDATA of "65.2.0-3.2.10.in-addr.arpa." would be generated.</p>
<p id="rfc.section.A.2.p.3">By protecting the "Ignore" characters from the generated RR's RDATA the focus for normalization becomes "65.2" as illustrated below.</p>
<pre>
       0
       v---------
         6 5 . 2 . 0 - 3 . 2 . 1 0 . i n - a d d r . a r p a .
        ---------^
                 2 2 2 2 1 1 1 1 1 1 1 1 1 1                  
                 3 2 1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
</pre>
<p id="rfc.section.A.2.p.4">Everything to the left of "65.2" will remain intact as will everything to its right.  The remaining characters will be processed for digits from 0 through 9 as indicated by the NPN record's hexadecimal flag "9", with each run replaced by the single character "9".  The final normalized RDATA would therefore become 9.9.0-3.2.10.in-addr.arpa and its signature would be based on this normalized RDATA field.  This new normalized string would be used as an RDATA for the wildcard label of 2.10.in-addr.arpa now encompassing all possible permutations of the ${*|.}.0-3.2.10.in-addr.arpa. pattern.</p>
<p id="rfc.section.A.2.p.5">As in example 1, the validatating resolver would use the same NPN record for comparison.</p>
<h1 id="rfc.appendix.A.3">
<a href="#rfc.appendix.A.3">A.3.</a> <a href="#example-3" id="example-3">EXAMPLE 3</a>
</h1>
<p id="rfc.section.A.3.p.1">This example provides reverse logic for example 1 by providing an IPv4 address record for a requested hostname.  For this example the query is defined as an A record for pool-A-3-44.example.com, with an origin of example.com.  RRs for this example are defined as:</p>
<pre>
example.com. 86400 IN BULK A (
                                   pool-A-[0-10]-[0-255]
                                   10.2.${*}
                                  )
example.com. 86400 IN NPN  A 9 0 8 0
</pre>
<p id="rfc.section.A.3.p.2">By protecting the "Ignore" characters from the generated RR's RDATA the focus for normalization becomes "003.044" as illustrated below.</p>
<pre>
                0 1 2 3 4 5 6 7 8
                                v--------------
                  0 1 0 . 0 0 2 . 0 0 3 . 0 4 4
                                 ---------------^
                                                0
</pre>
<p id="rfc.section.A.3.p.3">This example illustrates a key point about NPN records; since they are pre-canonical they MUST operate on a strict subset of WIRE formatted data.  For A and AAAA records this means the "Ignore" fields are based on zero padded data.  In this example our generated record MUST be converted into "010.002.003.044" (shown above) prior to processing.  After processing, wire format would become "0x0A02032C" (shown in hexadecimal).  This format would be too imprecise for normalization so padded decimal is used.</p>
<p id="rfc.section.A.3.p.4">Everything to the left of "003.044" will remain intact as will everything to its right.  The remaining characters will be processed for digits between 0 and 9 as indicated by the NPN record's hexadecimal flag "9" and each run replaced by the single character "9".  The final Normalized RDATA would therefore become 10.2.9.9 and its signature would be based on this normalized RDATA field. This new normalized A RR would be used as an RDATA for the wildcard label of "*.example.com." now encompassing all possible permutations of the 10.2.${*} pattern.</p>
<h1 id="rfc.appendix.A.4">
<a href="#rfc.appendix.A.4">A.4.</a> <a href="#example-4" id="example-4">EXAMPLE 4</a>
</h1>
<p id="rfc.section.A.4.p.1">This example provides similar logic for an IPv6 AAAA record.  For this example the query is defined as an AAAA record for pool-A-ff-aa.example.com with an origin of example.com..  RRs for this example are defined as:</p>
<pre>
example.com. 86400 IN BULK AAAA (
                                   pool-A-[0-ffff]-[0-ffff]
                                   fc00::${1}:${2}
                                )
example.com. 86400 IN NPN  AAAA X 0 30 0
</pre>
<p id="rfc.section.A.4.p.2">By protecting the "Ignore" characters from the generated RR's RDATA the focus for normalization becomes "00ff:00aa" as illustrated below.</p>
<pre>
                      1 1 1 1 1 1 1 1 1 1 2 2
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

    f c 0 0 : 0 0 0 0 : 0 0 0 0 : 0 0 0 0 : -/-/

  4 3 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 1
  0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0 9
   /-/-/- . . . . . . . . . . . . . . . . . . . . . . . . -/-/-/
                          2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 4
                          1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
                                            v------------------
                     /-/- 0 0 0 0 : 0 0 0 0 : 0 0 f f : 0 0 a a
                                             -------------------^
                        2 1 1 1 1 1 1 1 1 1 1 
                        0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
</pre>
<p id="rfc.section.A.4.p.3">This example reinforces the point on pre-canonical processing of NPN records; they MUST operate on a strict subset of WIRE formatted data. For A and AAAA records this means the "Ignore" fields are based on zero padded data.  In this example our generated record MUST be converted into "fc00:0000:0000:0000:0000:0000:00ff:00aa" (shown above) prior to processing.  After processing, wire format would become "0xFC000000000000000000000000FF00AA" (shown in hexadecimal). This format is slightly misleading as it is truly only 16 bytes of WIRE data and would be too imprecise for normalization so padded hexadecimal is used.</p>
<p id="rfc.section.A.4.p.4">Everything to the left of "00ff:00aa" will remain intact as will everything to its right.  The remaining characters will be processed for numbers between "0" and "f" as indicated by the NPN record's hexadecimal flag "X" and each run replaced by the single character "f".  The final Normalized RDATA would therefore become "fc00::f:f" and its signature would be based on this "normalized" RDATA field. This new "normalized" "AAAA" RR would be used as an RDATA for the wildcard label of *.example.com now encompassing all possible permutations of the "fc00::${1}:${2}" pattern.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">John Woodworth</span> 
	  <span class="n hidden">
		<span class="family-name">Woodworth</span>
	  </span>
	</span>
	<span class="org vcardline">CenturyLink, Inc.</span>
	<span class="adr">
	  <span class="vcardline">4250 N Fairfax Dr</span>

	  <span class="vcardline">
		<span class="locality">Arlington</span>,  
		<span class="region"></span>
		<span class="code">VA 22203</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:John.Woodworth@CenturyLink.com">John.Woodworth@CenturyLink.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dean Ballew</span> 
	  <span class="n hidden">
		<span class="family-name">Ballew</span>
	  </span>
	</span>
	<span class="org vcardline">CenturyLink, Inc.</span>
	<span class="adr">
	  <span class="vcardline">2355 Dulles Corner Blvd, Ste 200 300</span>

	  <span class="vcardline">
		<span class="locality">Herndon</span>,  
		<span class="region"></span>
		<span class="code">VA 20171</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Dean.Ballew@CenturyLink.com">Dean.Ballew@CenturyLink.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Shashwath Bindinganaveli Raghavan</span> 
	  <span class="n hidden">
		<span class="family-name">Bindinganaveli Raghavan</span>
	  </span>
	</span>
	<span class="org vcardline">Hughes Network Systems</span>
	<span class="adr">
	  <span class="vcardline">11717 Exploration Lane</span>

	  <span class="vcardline">
		<span class="locality">Germantown</span>,  
		<span class="region"></span>
		<span class="code">MD 20876</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shashwath.bindinganaveliraghavan@hughes.com">shashwath.bindinganaveliraghavan@hughes.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">David C Lawrence</span> 
	  <span class="n hidden">
		<span class="family-name">Lawrence</span>
	  </span>
	</span>
	<span class="org vcardline">Oracle</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tale@dd.org">tale@dd.org</a></span>

  </address>
</div>

</body>
</html>
